name: NBA Daily MLOps Pipeline

on:
  workflow_dispatch: # ğŸ‘ˆ åªä¿ç•™é€™å€‹ï¼é€™ä»£è¡¨å¿…é ˆç”±ä½ åœ¨ GitHub ç¶²é ä¸Šæ‰‹å‹•é»æ“ŠæŒ‰éˆ•æ‰æœƒåŸ·è¡Œ

jobs:
  daily_update:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: Check out repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas numpy requests bs4 urllib3 tqdm nba_api catboost scikit-learn

    # ğŸš€ ç›´æ¥å‘¼å«ä½ çš„ç¸½æ§å°è…³æœ¬ï¼
    - name: Run Entire NBA Pipeline
      env:
        PROXY_URL: ${{ secrets.PROXY_URL }}
      run: python src/run_pipeline.py

    # ğŸ’¾ æŠŠè·‘å®Œç”¢ç”Ÿçš„æ‰€æœ‰æ–°è³‡æ–™èˆ‡æ¨¡å‹å­˜å› GitHub
    - name: Commit and Push Results
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        
        # åŠ å…¥æ›´æ–°å¾Œçš„æª”æ¡ˆ
        git add data/nba_current.db
        git add nba_advanced_injury_features.csv
        git add nba_daily_walkforward_predictions.csv
        git add nba_daily_walkforward_summary.csv
        git add models/
        
        git commit -m "ğŸ¤– [MLOps] Manual Update: Data, Features & Models" || echo "No changes to commit"
        git push
